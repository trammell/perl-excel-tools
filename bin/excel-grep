#!/usr/bin/perl

use strict;
use warnings;
binmode(STDOUT, ":utf8");

use Algorithm::Diff;
use String::Diff;
use Spreadsheet::ParseExcel;
use Pod::Usage;
use Getopt::Long;
use List::MoreUtils 'mesh';

my %OPT = ();
GetOptions(\%OPT, 'man', 'file|f=s', 'help|h', 'verbose|v');
pod2usage("Please supply two filenames.") unless @ARGV == 2;

my $parser = Spreadsheet::ParseExcel->new();

# workbooks

for my $file (@ARGV) {
    my $wb = $parser->parse($file);
    unless ($wb) {
        die $parser->error(), "\n";
    }

    # get first worksheet only
    my $ws = $wb->worksheet(0);

    # get header
    my @header = get_header($ws);

    # look at all rows
    my ($rmin, $rmax) = $ws->row_range;
    my ($cmin, $cmax) = $ws->col_range;

    for my $row ($rmin .. $rmax) {
        for my $col ($cmin .. $cmax) {
            my $cell = $ws->get_cell($row, $col);
            my $value = eval { $cell->value() } || q();
            if ($OPT{literal}) {
                my @matches = grep { index($value,$_) < 0 } @patterns;
            }
            else {
                my @matches = grep { $value =~ /$_/ } @patterns;
            }
        }
    }

}


__END__

=pod

=head1 NAME

excel-grep - show the differences between two Excel files

=head1 SYNOPSIS

    excel-grep --help
    excel-grep string file.xls [...]
    excel-grep --file file file.xls [...]

=head1 ARGUMENTS

=cut

